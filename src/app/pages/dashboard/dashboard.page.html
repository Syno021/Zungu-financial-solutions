<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <div class="dashboard-title">
        <ion-icon name="pulse-outline" class="dashboard-icon"></ion-icon>
        <span *ngIf="(currentUser$ | async)?.type === 'facility'">Facility Dashboard</span>
        <span *ngIf="(currentUser$ | async)?.type === 'staff'">Staff Portal</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
      </ion-button>
      <ion-button routerLink="/profile">
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="circles"></ion-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Facility Dashboard -->
  <div *ngIf="(currentUser$ | async)?.type === 'facility' && !isLoading" class="dashboard-container">
    <ion-grid>
      <!-- Welcome Section -->
      <ion-row>
        <ion-col size="12">
          <ion-card class="welcome-card">
            <ion-card-content>
              <div class="welcome-content">
                <div>
                  <h1>Welcome, {{ (currentUser$ | async)?.data?.name }}</h1>
                  <p class="date-display">{{ today | date:'EEEE, MMMM d, y' }}</p>
                </div>
                <div class="welcome-actions">
                  <ion-button fill="outline" color="primary">
                    <ion-icon name="settings-outline" slot="start"></ion-icon>
                    Settings
                  </ion-button>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <!-- Quick Stats -->
      <ion-row>
        <ion-col size="12" size-md="6" size-lg="3">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon patients-icon">
                <ion-icon name="people"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.patients }}</h2>
                <p>Patients</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6" size-lg="3">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon staff-icon">
                <ion-icon name="medical"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.staff }}</h2>
                <p>Staff</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6" size-lg="3">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon rooms-icon">
                <ion-icon name="bed"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.rooms }}</h2>
                <p>Rooms</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6" size-lg="3">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon inventory-icon">
                <ion-icon name="medkit"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.inventory }}</h2>
                <p>Inventory Items</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <!-- Main Action Cards -->
      <ion-row>
        <ion-col size="12" size-lg="8">
          <ion-card class="control-card">
            <ion-card-header>
              <ion-card-title>Control Center</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="control-buttons">
                <ion-button class="control-button" (click)="navigateTo('add-staff')">
                  <div class="button-content">
                    <ion-icon name="person-add"></ion-icon>
                    <span>Add Staff</span>
                  </div>
                </ion-button>
                
                <ion-button class="control-button" (click)="navigateTo('analytics')">
                  <div class="button-content">
                    <ion-icon name="analytics"></ion-icon>
                    <span>Analytics</span>
                  </div>
                </ion-button>
                
                <ion-button class="control-button" (click)="navigateTo('inventory')">
                  <div class="button-content">
                    <ion-icon name="medical-supplies"></ion-icon>
                    <span>Inventory</span>
                  </div>
                </ion-button>
                
                <ion-button class="control-button" (click)="navigateTo('room-allocation')">
                  <div class="button-content">
                    <ion-icon name="bed"></ion-icon>
                    <span>Room Allocation</span>
                  </div>
                </ion-button>
                
                <ion-button class="control-button" (click)="navigateTo('patient-card')">
                  <div class="button-content">
                    <ion-icon name="card"></ion-icon>
                    <span>Patient Card</span>
                  </div>
                </ion-button>
                
                <ion-button class="control-button" (click)="navigateTo('ehr')">
                  <div class="button-content">
                    <ion-icon name="document-text"></ion-icon>
                    <span>EHR</span>
                  </div>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
          
          <!-- More Stats Row -->
          <ion-row>
            <ion-col size="12" size-md="6">
              <ion-card class="stat-card">
                <ion-card-header>
                  <ion-card-title>Clinical Information</ion-card-title>
                </ion-card-header>
                <ion-card-content>
                  <div class="clinical-stats">
                    <div class="clinical-stat-item">
                      <ion-icon name="document"></ion-icon>
                      <div>
                        <h3>{{ dashboardMetrics.ehrs }}</h3>
                        <p>Electronic Health Records</p>
                      </div>
                    </div>
                    <div class="clinical-stat-item">
                      <ion-icon name="flask"></ion-icon>
                      <div>
                        <h3>{{ dashboardMetrics.labResults }}</h3>
                        <p>Lab Results</p>
                      </div>
                    </div>
                    <div class="clinical-stat-item">
                      <ion-icon name="scan"></ion-icon>
                      <div>
                        <h3>{{ dashboardMetrics.radiologyResults }}</h3>
                        <p>Radiology Results</p>
                      </div>
                    </div>
                    <div class="clinical-stat-item">
                      <ion-icon name="receipt"></ion-icon>
                      <div>
                        <h3>{{ dashboardMetrics.prescriptions }}</h3>
                        <p>Prescriptions</p>
                      </div>
                    </div>
                  </div>
                </ion-card-content>
              </ion-card>
            </ion-col>
            
            <ion-col size="12" size-md="6">
              <ion-card>
                <ion-card-header>
                  <ion-card-title>Quick Actions</ion-card-title>
                </ion-card-header>
                <ion-card-content>
                  <ion-list lines="none">
                    <ion-item button detail="true" (click)="navigateTo('add-patient')">
                      <ion-icon name="person-add-outline" slot="start" color="primary"></ion-icon>
                      <ion-label>Add New Patient</ion-label>
                    </ion-item>
                    <ion-item button detail="true" (click)="navigateTo('schedule')">
                      <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
                      <ion-label>View Schedule</ion-label>
                    </ion-item>
                    <ion-item button detail="true" (click)="navigateTo('reports')">
                      <ion-icon name="document-text-outline" slot="start" color="primary"></ion-icon>
                      <ion-label>Generate Reports</ion-label>
                    </ion-item>
                    <ion-item button detail="true" (click)="navigateTo('emergency')">
                      <ion-icon name="alert-circle-outline" slot="start" color="danger"></ion-icon>
                      <ion-label>Emergency Protocols</ion-label>
                    </ion-item>
                  </ion-list>
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>
        </ion-col>
        
        <!-- Charts Section -->
        <ion-col size="12" size-lg="4">
          <!-- Staff Distribution -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Staff Distribution</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div id="staffChart" class="chart-container">
                <!-- Chart will be rendered here -->
                <p class="chart-placeholder">Staff distribution chart</p>
              </div>
            </ion-card-content>
          </ion-card>
          
          <!-- Patient Demographics -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Patient Demographics</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div id="patientChart" class="chart-container">
                <!-- Chart will be rendered here -->
                <p class="chart-placeholder">Patient demographics chart</p>
              </div>
            </ion-card-content>
          </ion-card>
          
          <!-- Recent Activity -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Recent Activity</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list lines="full">
                <ion-item>
                  <ion-icon name="person-add" slot="start" color="success"></ion-icon>
                  <ion-label>
                    <h3>New Patient Registered</h3>
                    <p>John Doe - 15 minutes ago</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="document-text" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Lab Results Updated</h3>
                    <p>Patient #2458 - 1 hour ago</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="medical" slot="start" color="secondary"></ion-icon>
                  <ion-label>
                    <h3>Staff Shift Change</h3>
                    <p>Dr. Smith - 2 hours ago</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="bed" slot="start" color="warning"></ion-icon>
                  <ion-label>
                    <h3>Room Status Updated</h3>
                    <p>Room 302 - 3 hours ago</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Staff Dashboard -->
  <div *ngIf="(currentUser$ | async)?.type === 'staff' && !isLoading" class="dashboard-container">
    <ion-grid>
      <!-- Welcome Section for Staff -->
      <ion-row>
        <ion-col size="12">
          <ion-card class="welcome-card">
            <ion-card-content>
              <div class="welcome-content">
                <div>
                  <h1>Welcome, Dr. {{ (currentUser$ | async)?.data?.name }}</h1>
                  <p class="date-display">{{ today | date:'EEEE, MMMM d, y' }}</p>
                  <p class="staff-role">{{ getUserRole(currentUser$ | async) }} - {{ getUserSpecialization(currentUser$ | async) }}</p>
                </div>
                <div class="staff-avatar">
                  <ion-avatar>
                    <img [src]="getUserProfilePicture(currentUser$ | async)" alt="Staff Photo">
                  </ion-avatar>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      
      <!-- Staff Quick Stats -->
      <ion-row>
        <ion-col size="12" size-md="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon patients-icon">
                <ion-icon name="people"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.assignedPatients }}</h2>
                <p>Assigned Patients</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="12" size-md="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon appointments-icon">
                <ion-icon name="calendar"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.upcomingAppointments }}</h2>
                <p>Upcoming Appointments</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="12" size-md="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-icon tasks-icon">
                <ion-icon name="clipboard"></ion-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardMetrics.pendingTasks }}</h2>
                <p>Pending Tasks</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      
      <!-- Staff Main Content -->
      <ion-row>
        <ion-col size="12" size-lg="8">
          <!-- Today's Schedule -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Today's Schedule</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list lines="full">
                <ion-item>
                  <ion-label>
                    <h2>09:00 AM - Patient Consultation</h2>
                    <p>John Doe - Room 203</p>
                  </ion-label>
                  <ion-button slot="end" fill="clear" color="primary">View</ion-button>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h2>10:30 AM - Lab Review</h2>
                    <p>Sarah Smith - Test Results</p>
                  </ion-label>
                  <ion-button slot="end" fill="clear" color="primary">View</ion-button>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h2>12:00 PM - Lunch Break</h2>
                    <p>60 minutes</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h2>01:30 PM - Staff Meeting</h2>
                    <p>Conference Room B</p>
                  </ion-label>
                  <ion-button slot="end" fill="clear" color="primary">View</ion-button>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h2>03:00 PM - Follow-up Visit</h2>
                    <p>Michael Johnson - Room 105</p>
                  </ion-label>
                  <ion-button slot="end" fill="clear" color="primary">View</ion-button>
                </ion-item>
              </ion-list>
              <div class="view-all-button">
                <ion-button fill="clear" (click)="navigateTo('schedule')">
                  View Full Schedule
                  <ion-icon name="arrow-forward" slot="end"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
          
          <!-- Patient Quick Access -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Assigned Patients</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-searchbar placeholder="Search patients..."></ion-searchbar>
              <ion-list lines="full">
                <ion-item *ngFor="let i of [1,2,3,4]" button detail="true" (click)="navigateTo('patient-detail')">
                  <ion-avatar slot="start">
                    <img src="assets/patient-placeholder.png" alt="Patient">
                  </ion-avatar>
                  <ion-label>
                    <h2>Patient Name {{i}}</h2>
                    <p>ID: #10{{i}}24 • Last Visit: Mar {{i}}, 2025</p>
                  </ion-label>
                  <ion-badge *ngIf="i === 2" color="danger" slot="end">Urgent</ion-badge>
                </ion-item>
              </ion-list>
              <div class="view-all-button">
                <ion-button fill="clear" (click)="navigateTo('patients')">
                  View All Patients
                  <ion-icon name="arrow-forward" slot="end"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="12" size-lg="4">
          <!-- Staff Information -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>My Information</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list lines="none">
                <ion-item>
                  <ion-icon name="medical" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <p>Staff ID</p>
                    <h3>{{ getUserStaffId(currentUser$ | async) }}</h3>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="mail" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <p>Email</p>
                    <h3>{{ getUserEmail(currentUser$ | async) }}</h3>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="call" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <p>Phone</p>
                    <h3>{{ getUserPhone(currentUser$ | async) }}</h3>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="business" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <p>Facility ID</p>
                    <h3>{{ (currentUser$ | async)?.data?.facilityId }}</h3>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="finger-print" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <p>Registration Number</p>
                    <h3>{{ getUserRegistrationNumber(currentUser$ | async) }}</h3>
                  </ion-label>
                </ion-item>
              </ion-list>
              <ion-button expand="block" fill="outline" color="primary" routerLink="/profile">
                Edit Profile
              </ion-button>
            </ion-card-content>
          </ion-card>
          
          <!-- Tasks & Notifications -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Pending Tasks</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list lines="full">
                <ion-item *ngFor="let i of [1,2,3]">
                  <ion-checkbox slot="start"></ion-checkbox>
                  <ion-label>
                    <h3>Complete patient notes</h3>
                    <p>Due: Today</p>
                  </ion-label>
                  <ion-badge color="warning" slot="end">High</ion-badge>
                </ion-item>
                <ion-item>
                  <ion-checkbox slot="start"></ion-checkbox>
                  <ion-label>
                    <h3>Review lab results</h3>
                    <p>Due: Tomorrow</p>
                  </ion-label>
                  <ion-badge color="medium" slot="end">Medium</ion-badge>
                </ion-item>
              </ion-list>
              <div class="view-all-button">
                <ion-button fill="clear" (click)="navigateTo('tasks')">
                  View All Tasks
                  <ion-icon name="arrow-forward" slot="end"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
          
          <!-- Quick Access Tools -->
          <ion-card>
            <ion-card-header>
              <ion-card-title>Quick Tools</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="quick-tools">
                <ion-button class="tool-button" (click)="navigateTo('create-prescription')">
                  <ion-icon name="document-text"></ion-icon>
                  <span>Prescription</span>
                </ion-button>
                <ion-button class="tool-button" (click)="navigateTo('create-referral')">
                  <ion-icon name="share"></ion-icon>
                  <span>Referral</span>
                </ion-button>
                <ion-button class="tool-button" (click)="navigateTo('lab-request')">
                  <ion-icon name="flask"></ion-icon>
                  <span>Lab Order</span>
                </ion-button>
                <ion-button class="tool-button" (click)="navigateTo('radiology-request')">
                  <ion-icon name="scan"></ion-icon>
                  <span>Radiology</span>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>