<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <ion-icon name="medkit-outline" class="ion-margin-end"></ion-icon>
      Patient Portal
    </ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
      </ion-button>
      <ion-button>
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Loading indicator -->
  <div *ngIf="loading" class="ion-text-center ion-padding">
    <ion-spinner name="circular"></ion-spinner>
    <p>Loading your information...</p>
  </div>

  <!-- Error message -->
  <ion-card *ngIf="error" color="danger">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="alert-circle-outline" class="ion-margin-end"></ion-icon>
        Error
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>{{ error }}</ion-card-content>
  </ion-card>

  <!-- Quick Action Buttons -->
  <div *ngIf="patient && !loading" class="quick-actions ion-margin-bottom">
    <ion-segment scrollable value="overview">
      <ion-segment-button value="overview">
        <ion-icon name="home-outline"></ion-icon>
        <ion-label>Overview</ion-label>
      </ion-segment-button>
      <ion-segment-button value="appointments" routerLink="/appointments">
        <ion-icon name="calendar-outline"></ion-icon>
        <ion-label>Appointments</ion-label>
      </ion-segment-button>
      <ion-segment-button value="records" (click)="viewMyEhrRecords()">
        <ion-icon name="document-text-outline"></ion-icon>
        <ion-label>Records</ion-label>
      </ion-segment-button>
      <ion-segment-button value="patientcard" routerLink="/patient-card">
        <ion-icon name="card-outline"></ion-icon>
        <ion-label>Patient Card</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Patient information -->
  <div *ngIf="patient && !loading">
    <ion-card class="ion-margin-bottom">
      <ion-card-header>
        <ion-card-subtitle>
          <ion-icon name="person-outline" class="ion-margin-end"></ion-icon>
          Patient Information
        </ion-card-subtitle>
        <ion-card-title>{{ patient.name }}</ion-card-title>
        <ion-chip color="primary" outline>
          <ion-icon name="finger-print-outline"></ion-icon>
          <ion-label>ID: {{ patient.patientId }}</ion-label>
        </ion-chip>
      </ion-card-header>
      <ion-card-content>
        <ion-accordion-group>
          <ion-accordion value="personal">
            <ion-item slot="header">
              <ion-icon name="person-circle-outline" slot="start"></ion-icon>
              <ion-label>Personal Information</ion-label>
            </ion-item>
            <div slot="content">
              <ion-list lines="none">
                <ion-item>
                  <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Email</h3>
                    <p>{{ patient.email }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="id-card-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>ID Number</h3>
                    <p>{{ patient.saIdNumber || 'Not provided' }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Date of Birth</h3>
                    <p>{{ formatDate(patient.dob) }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="transgender-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Gender</h3>
                    <p>{{ patient.gender }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Contact Number</h3>
                    <p>{{ patient.contactNumber }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="home-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Address</h3>
                    <p>{{ patient.address.street }}, {{ patient.address.city }}</p>
                    <p>{{ patient.address.province }}, {{ patient.address.postalCode }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="calendar-number-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Registered On</h3>
                    <p>{{ formatDate(patient.registeredAt) }}</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
        </ion-accordion-group>
        
        <div class="action-buttons ion-padding-top">
          <ion-button expand="block" color="primary" (click)="viewMyEhrRecords()">
            <ion-icon name="document-text-outline" slot="start"></ion-icon>
            View My EHR Records
          </ion-button>
          
          <div class="button-row">
            <ion-button expand="block" routerLink="/appointments" color="secondary">
              <ion-icon name="calendar-outline" slot="start"></ion-icon>
              Make an Appointment
            </ion-button>
            
            <ion-button expand="block" routerLink="/patient-card" color="secondary">
              <ion-icon name="card-outline" slot="start"></ion-icon>
              View Patient Card
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Next of Kin information -->
    <ion-card class="ion-margin-bottom">
      <ion-card-header>
        <ion-card-subtitle>
          <ion-icon name="people-outline" class="ion-margin-end"></ion-icon>
          Emergency Contact
        </ion-card-subtitle>
        <ion-card-title>Next of Kin</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-icon name="person-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Name</h3>
              <p>{{ patient.nextOfKin.name }}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="link-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Relationship</h3>
              <p>{{ patient.nextOfKin.relationship }}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Contact Number</h3>
              <p>{{ patient.nextOfKin.contactNumber }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Facility information -->
    <ion-card *ngIf="facility">
      <ion-card-header>
        <ion-card-subtitle>
          <ion-icon name="business-outline" class="ion-margin-end"></ion-icon>
          Healthcare Provider
        </ion-card-subtitle>
        <ion-card-title>{{ facility.name }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-accordion-group>
          <ion-accordion value="facility">
            <ion-item slot="header">
              <ion-icon name="information-circle-outline" slot="start"></ion-icon>
              <ion-label>Facility Details</ion-label>
            </ion-item>
            <div slot="content">
              <ion-list lines="none">
                <ion-item>
                  <ion-icon name="medical-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Facility Type</h3>
                    <p>{{ facility.type }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="document-text-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Registration Number</h3>
                    <p>{{ facility.registrationNumber }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Contact Email</h3>
                    <p>{{ facility.contactEmail }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Contact Phone</h3>
                    <p>{{ facility.contactPhone }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Location</h3>
                    <p>{{ facility.location.street }}, {{ facility.location.city }}</p>
                    <p>{{ facility.location.province }}, {{ facility.location.postalCode }}</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>

<ion-footer *ngIf="patient && !loading">
  <ion-toolbar color="light">
    <ion-tabs>
      <ion-tab-bar slot="bottom">
        <ion-tab-button tab="home">
          <ion-icon name="home-outline"></ion-icon>
          <ion-label>Home</ion-label>
        </ion-tab-button>
        <ion-tab-button tab="appointments" routerLink="/appointments">
          <ion-icon name="calendar-outline"></ion-icon>
          <ion-label>Appointments</ion-label>
        </ion-tab-button>
        <ion-tab-button tab="records" (click)="viewMyEhrRecords()">
          <ion-icon name="document-text-outline"></ion-icon>
          <ion-label>Records</ion-label>
        </ion-tab-button>
        <ion-tab-button tab="profile">
          <ion-icon name="person-outline"></ion-icon>
          <ion-label>Profile</ion-label>
        </ion-tab-button>
      </ion-tab-bar>
    </ion-tabs>
  </ion-toolbar>
</ion-footer>