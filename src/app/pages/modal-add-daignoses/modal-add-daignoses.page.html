<ion-header>
  <ion-toolbar>
    <ion-title>Add Medical Information for {{ ehr?.surname }}, {{ ehr?.name }} </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleFullscreen()">
        <ion-icon [name]="isFullscreen ? 'contract-outline' : 'expand-outline'"></ion-icon>
      </ion-button>
      <ion-button (click)="dismiss()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [(ngModel)]="segment" (ionChange)="segmentChanged($event)">
      <ion-segment-button value="diagnosis">
        <ion-label>Diagnosis</ion-label>
      </ion-segment-button>
      <ion-segment-button value="prescription">
        <ion-label>Prescription</ion-label>
      </ion-segment-button>
      <ion-segment-button value="lab">
        <ion-label>Lab Result</ion-label>
      </ion-segment-button>
      <ion-segment-button value="radiology">
        <ion-label>Radiology</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="error" class="ion-padding">
    <ion-item color="danger">
      <ion-icon name="alert-circle-outline" slot="start"></ion-icon>
      <ion-label>{{ error }}</ion-label>
    </ion-item>
  </div>
  
  <div class="ion-padding">
    <h3>Patient: {{ ehr?.surname }}, {{ ehr?.name }}</h3>
    <p>Patient ID: {{ ehr?.patientId }}</p>
  </div>
  
  <!-- Diagnosis Form -->
  <div [hidden]="segment !== 'diagnosis'">
    <form [formGroup]="diagnosisForm" (ngSubmit)="addDiagnosis()">
      <ion-item>
        <ion-label position="stacked">Diagnosis Name <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="name" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">ICD-10 Code <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="icd10Code" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">SNOMED Code <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="snomedCode" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Diagnosed Date <ion-text color="danger">*</ion-text></ion-label>
        <ion-datetime formControlName="diagnosedDate" displayFormat="MMM DD, YYYY"></ion-datetime>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Status <ion-text color="danger">*</ion-text></ion-label>
        <ion-select formControlName="status">
          <ion-select-option value="Active">Active</ion-select-option>
          <ion-select-option value="Resolved">Resolved</ion-select-option>
          <ion-select-option value="Recurring">Recurring</ion-select-option>
        </ion-select>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Treating Physician <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="treatingPhysician" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Notes</ion-label>
        <ion-textarea formControlName="notes" rows="4"></ion-textarea>
      </ion-item>
      
      <div class="ion-padding">
        <ion-button expand="block" type="submit" [disabled]="!diagnosisForm.valid || loading">
          <ion-spinner *ngIf="loading"></ion-spinner>
          <span *ngIf="!loading">Add Diagnosis</span>
        </ion-button>
      </div>
    </form>
  </div>
  
  <!-- Prescription Form -->
  <div [hidden]="segment !== 'prescription'">
    <form [formGroup]="prescriptionForm" (ngSubmit)="addPrescription()">
      <ion-item>
        <ion-label position="stacked">Medication <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="medication" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Dosage <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="dosage" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Duration <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="duration" type="text" required></ion-input>
      </ion-item>
      
      <div class="ion-padding">
        <ion-button expand="block" type="submit" [disabled]="!prescriptionForm.valid || loading">
          <ion-spinner *ngIf="loading"></ion-spinner>
          <span *ngIf="!loading">Add Prescription</span>
        </ion-button>
      </div>
    </form>
  </div>
  
  <!-- Lab Result Form -->
  <div [hidden]="segment !== 'lab'">
    <form [formGroup]="labResultForm" (ngSubmit)="addLabResult()">
      <ion-item>
        <ion-label position="stacked">Test Name <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="testName" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">LOINC Code <ion-text color="danger">*</ion-text></ion-label>
        <ion-input formControlName="loincCode" type="text" required></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Result <ion-text color="danger">*</ion-text></ion-label>
        <ion-textarea formControlName="result" rows="4" required></ion-textarea>
      </ion-item>
      
      <div class="ion-padding">
        <ion-button expand="block" type="submit" [disabled]="!labResultForm.valid || loading">
          <ion-spinner *ngIf="loading"></ion-spinner>
          <span *ngIf="!loading">Add Lab Result</span>
        </ion-button>
      </div>
    </form>
  </div>
  
  <!-- Radiology Form -->
  <div [hidden]="segment !== 'radiology'">
    <form [formGroup]="radiologyForm" (ngSubmit)="addRadiologyResult()">
      <ion-item>
        <ion-label position="stacked">Scan Type <ion-text color="danger">*</ion-text></ion-label>
        <ion-select formControlName="scanType" required>
          <ion-select-option value="X-Ray">X-Ray</ion-select-option>
          <ion-select-option value="CT Scan">CT Scan</ion-select-option>
          <ion-select-option value="MRI">MRI</ion-select-option>
          <ion-select-option value="Ultrasound">Ultrasound</ion-select-option>
          <ion-select-option value="PET Scan">PET Scan</ion-select-option>
        </ion-select>
      </ion-item>
      
      <ion-item>
        <ion-label position="stacked">Findings <ion-text color="danger">*</ion-text></ion-label>
        <ion-textarea formControlName="findings" rows="4" required></ion-textarea>
      </ion-item>
      
      <div class="ion-padding">
        <ion-button expand="block" type="submit" [disabled]="!radiologyForm.valid || loading">
          <ion-spinner *ngIf="loading"></ion-spinner>
          <span *ngIf="!loading">Add Radiology Result</span>
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>