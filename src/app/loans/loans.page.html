<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Loans</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Loans</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Loan Information Section -->
  <div class="loan-info-container">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Our Loan Offerings</ion-card-title>
        <ion-card-subtitle>Competitive rates and flexible terms</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <p>We offer various loan products to meet your financial needs with competitive interest rates and flexible repayment terms.</p>
      </ion-card-content>
    </ion-card>

    <!-- Loan Types -->
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title color="primary">Personal Loans</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label>
                    <h3>Amount Range</h3>
                    <p>R5,000 - R250,000</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Interest Rate</h3>
                    <p>12% - 24% per annum</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Term</h3>
                    <p>6 - 72 months</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title color="secondary">Business Loans</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label>
                    <h3>Amount Range</h3>
                    <p>R10,000 - R1,000,000</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Interest Rate</h3>
                    <p>10% - 20% per annum</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Term</h3>
                    <p>12 - 120 months</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title color="tertiary">Vehicle Loans</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label>
                    <h3>Amount Range</h3>
                    <p>R50,000 - R2,000,000</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Interest Rate</h3>
                    <p>8% - 18% per annum</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Term</h3>
                    <p>24 - 84 months</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title color="success">Home Loans</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label>
                    <h3>Amount Range</h3>
                    <p>R100,000 - R5,000,000</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Interest Rate</h3>
                    <p>7% - 15% per annum</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-label>
                    <h3>Term</h3>
                    <p>120 - 240 months</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Requirements Section -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Loan Requirements</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
            <ion-label>South African citizen or permanent resident</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
            <ion-label>Minimum age of 18 years</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
            <ion-label>Proof of income (3 months payslips)</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
            <ion-label>Valid ID document</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
            <ion-label>Bank statements (3 months)</ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Apply Button -->
    <div class="apply-button-container">
      <ion-button expand="full" size="large" color="primary" (click)="openLoanApplicationModal()">
        <ion-icon name="card" slot="start"></ion-icon>
        Apply for a Loan Now
      </ion-button>
    </div>
  </div>

  <!-- Loan Application Modal -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Loan Application</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <form (ngSubmit)="submitLoanApplication()" #loanForm="ngForm">
          <ion-list>
            <ion-item>
              <ion-select 
                label="Loan Type" 
                placeholder="Select loan type" 
                [(ngModel)]="loanApplication.purpose" 
                name="purpose" 
                required>
                <ion-select-option value="personal">Personal Loan</ion-select-option>
                <ion-select-option value="business">Business Loan</ion-select-option>
                <ion-select-option value="vehicle">Vehicle Loan</ion-select-option>
                <ion-select-option value="home">Home Loan</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Loan Amount (R)" 
                type="number" 
                placeholder="Enter amount" 
                [(ngModel)]="loanApplication.amount" 
                name="amount" 
                required
                min="1000">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-select 
                label="Loan Term" 
                placeholder="Select term" 
                [(ngModel)]="loanApplication.term" 
                name="term" 
                required>
                <ion-select-option value="6">6 months</ion-select-option>
                <ion-select-option value="12">12 months</ion-select-option>
                <ion-select-option value="18">18 months</ion-select-option>
                <ion-select-option value="24">24 months</ion-select-option>
                <ion-select-option value="36">36 months</ion-select-option>
                <ion-select-option value="48">48 months</ion-select-option>
                <ion-select-option value="60">60 months</ion-select-option>
                <ion-select-option value="72">72 months</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Full Name" 
                type="text" 
                placeholder="Enter your full name" 
                [(ngModel)]="loanApplication.fullName" 
                name="fullName" 
                required>
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Email Address" 
                type="email" 
                placeholder="Enter your email" 
                [(ngModel)]="loanApplication.email" 
                name="email" 
                required>
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Phone Number" 
                type="tel" 
                placeholder="Enter your phone number" 
                [(ngModel)]="loanApplication.phone" 
                name="phone" 
                required>
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Monthly Income (R)" 
                type="number" 
                placeholder="Enter monthly income" 
                [(ngModel)]="loanApplication.monthlyIncome" 
                name="monthlyIncome" 
                required>
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-textarea 
                label="Additional Information" 
                placeholder="Any additional information about your loan application" 
                [(ngModel)]="loanApplication.additionalInfo" 
                name="additionalInfo"
                rows="3">
              </ion-textarea>
            </ion-item>
          </ion-list>

          <!-- Estimated Interest Rate Display -->
          <ion-card *ngIf="estimatedRate > 0">
            <ion-card-header>
              <ion-card-title color="primary">Estimated Loan Details</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label>
                  <h3>Estimated Interest Rate</h3>
                  <p>{{ estimatedRate }}% per annum</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>Estimated Monthly Payment</h3>
                  <p>R{{ calculateMonthlyPayment() | number:'1.2-2' }}</p>
                </ion-label>
              </ion-item>
            </ion-card-content>
          </ion-card>

          <div class="ion-padding">
            <ion-button 
              expand="full" 
              type="submit" 
              color="primary" 
              [disabled]="!loanForm.valid || isSubmitting">
              <ion-icon name="send" slot="start"></ion-icon>
              {{ isSubmitting ? 'Submitting...' : 'Submit Application' }}
            </ion-button>
          </div>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>